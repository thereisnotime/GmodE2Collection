@name exploits/tf2_gore
@persist N INTERVAL GIB_MODELS:array Count

# Accidentally patched Jun 13 2023 in commit 250f11d, gmod_wire_expression2/core/custom/prop.lua:104
# https://github.com/wiremod/wire/commit/250f11d

# GAME-CONTENT: requires tf2 mounted 

# by Fasteroid
# powered by propSpawn ragdolls (might not work on all servers)
# spews blood and tf2 gibs everywhere

if( first() ){
    INTERVAL = 250
    GIB_MODELS = array(
        "models/player/scout.mdl",
        "models/player/soldier.mdl",
        "models/player/pyro.mdl",
        "models/player/demo.mdl",
        "models/player/heavy.mdl",
        "models/player/engineer.mdl",
        "models/player/medic.mdl",
        "models/player/sniper.mdl",
        "models/player/spy.mdl"
    )
    
    Count = GIB_MODELS:count()
    N = 0
    timer("emit",INTERVAL)
}

if( clk("emit") ){
    if( propCanCreate() ){
        N = (N + 1) % Count
        Mdl = GIB_MODELS[N+1,string]
        local E = propSpawn(Mdl,entity():toWorld(vec(0,0,20)),randvec():toAngle(),0)
        
        E:applyForce( (randvec():setZ(0)*400 + vec(0,0,-500))*E:mass() )
        E:setColor( vec(255,0,0) )

        E:propBreak()
        timer("emit",INTERVAL)        
    }
}
